---
title: "Advanced Models"
output: html_document
---
install.packages(e1071)
```{r setup, include=FALSE}
library(tidyverse)
library(lubridate)
library(dplyr)
two_points <- read_csv("two_point_attempts.csv") 
  

```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r}

svm_df <- two_points %>%
  select(two_point_conv_result,
         score_differential,
         score_differential_post,
         completion_percentage,
         qtr,
         game_seconds_remaining,
         total_yards_gained,
         num_runs,
         num_passes,play_num,
         num_runs_greater_than_2yds,
         num_runs_greater_than_2yds,
         prop_runs_greater_than_2_yards,
         prop_passes_greater_than_2_yards,
         avg_yards_per_run,
         avg_yards_per_pass)
```




```{r}
library(caret)
library(factoextra)
##predict on play type and the result is independent variables
##PCA with just one variable?
run.pr <- prcomp(svm_df[c(1:15)], center = TRUE, scale = TRUE)
fviz_pca_ind(run.pr, geom.ind = "point", pointshape = 21, 
             pointsize = 2, 
             fill.ind = as.factor(svm_df$two_point_conv_result), 
             col.ind = "black", 
             palette = "jco", 
             addEllipses = TRUE,
             label = "var",
             col.var = "black",
             repel = TRUE,
             legend.title = "2-Point Conversion Result") +
  ggtitle("2D PCA-plot from 15 feature dataset") +
  theme(plot.title = element_text(hjust = 0.5))
```


```{r}

variables_lowCorrelation <- svm_df %>%
  select(two_point_conv_result,
         score_differential,
         total_yards_gained,
         avg_yards_per_pass,
         completion_percentage,
         avg_yards_per_run,
         game_seconds_remaining,
         )
set.seed(317)
variables_lowCorrelation <- na.omit(variables_lowCorrelation)
n<-nrow(variables_lowCorrelation)
ntrain<- round(n*.9)
svm_plays <-sample(n,ntrain)
train_plays <- variables_lowCorrelation[svm_plays,]
test_plays <- variables_lowCorrelation[-svm_plays,]

model <- svm(formula = two_point_conv_result ~ ., data = train_plays, type = 'C-classification', kernel = 'radial')

radialPredict = predict(model, test_plays)

confusionMatrix(table(test_plays$two_point_conv_result,radialPredict ))


```

```{r}

##SAME AS ABOVE BUT JUST IN FOR LOOP 
variables_lowCorrelation1 <- svm_df %>%
  select(two_point_conv_result,
         score_differential,
         total_yards_gained,
         prop_passes_greater_than_2_yards,
         completion_percentage,
         prop_runs_greater_than_2_yards,
         game_seconds_remaining,
         )
accuracyList = 0

for (i in (1:100)){
  variables_lowCorrelation <- na.omit(variables_lowCorrelation)
  n<-nrow(variables_lowCorrelation)
  ntrain<- round(n*.9)
  svm_plays <-sample(n,ntrain)
  train_plays <- variables_lowCorrelation[svm_plays,]
  test_plays <- variables_lowCorrelation[-svm_plays,]
  
  model <- svm(formula = two_point_conv_result ~ ., data = train_plays, type = 'C-classification', kernel = 'polynomial')
  
  radialPredict = predict(model, test_plays)
  confusion <-confusionMatrix(table(test_plays$two_point_conv_result,radialPredict ))
  accuracyList = accuracyList + confusion$overall[["Accuracy"]]

  }

```

```{r}
accuracyList/100
```


